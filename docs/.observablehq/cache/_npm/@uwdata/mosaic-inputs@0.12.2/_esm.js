/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.37.0.
 * Original file: /npm/@uwdata/mosaic-inputs@0.12.2/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{coordinator as t,MosaicClient as e,isSelection as s,clausePoint as i,isParam as n,clauseMatch as l,clauseInterval as r,clausePoints as h,toDataColumns as a}from"../mosaic-core@0.12.2/_esm.js";import{Query as o,min as c,max as u,desc as d}from"../mosaic-sql@0.12.2/_esm.js";import{format as m}from"../../isoformat@0.2.1/_esm.js";function p(e,s){const i=new e(s);return t().connect(i),i.element}const f=t=>p(v,t);class v extends e{constructor({element:t,filterBy:e,as:i,from:n,column:l,label:r=l,format:h=t=>t,options:a,value:o,field:c=l}={}){super(e),this.from=n,this.column=l,this.format=h,this.field=c;const u=this.selection=i;this.element=t??document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this});const d=document.createElement("label");if(d.innerText=r||l,this.element.appendChild(d),this.select=document.createElement("select"),this.element.appendChild(this.select),a&&(this.data=a.map((t=>{return(e=t)&&"object"==typeof e&&!Array.isArray(e)?t:{value:t};var e})),this.selectedValue(void 0===o?"":o),this.update()),u){const t=!s(u);null==o||t&&void 0!==u.value||this.publish(o),this.select.addEventListener("input",(()=>{this.publish(this.selectedValue()??null)})),t?this.selection.addEventListener("value",(t=>{t!==this.select.value&&this.selectedValue(t)})):(this.select.addEventListener("pointerenter",(t=>{t.buttons||this.activate()})),this.select.addEventListener("focus",(()=>this.activate())))}}selectedValue(t){if(0===arguments.length){const t=this.select.selectedIndex;return this.data[t].value}{const e=this.data?.findIndex((e=>e.value===t));e>=0?this.select.selectedIndex=e:this.select.value=String(t)}}reset(){this.select.selectedIndex=this.from?0:-1}activate(){this.selection.activate(i(this.field,0,{source:this}))}publish(t){const{selection:e,field:l}=this;if(s(e)){""===t&&(t=void 0);const s=i(l,t,{source:this});e.update(s)}else n(e)&&e.update(t)}query(t=[]){const{from:e,column:s}=this;return e?o.from(e).select({value:s}).distinct().where(t).orderby(s):null}queryResult(t){return this.data=[{value:"",label:"All"},...t],this}update(){const{data:t,format:e,select:i,selection:n}=this;i.replaceChildren();for(const{value:s,label:i}of t){const t=document.createElement("option");t.setAttribute("value",s),t.innerText=i??e(s),this.select.appendChild(t)}if(n){const t=s(n)?n.valueFor(this):n.value;this.selectedValue(void 0===t?"":t)}return this}}let b=0;const x=t=>p(y,t);class y extends e{constructor({element:t,filterBy:e,from:i,column:n,label:l,type:r="contains",field:h=n,as:a}={}){if(super(e),this.id="search_"+ ++b,this.type=r,this.from=i,this.column=n,this.selection=a,this.field=h,this.element=t??document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this}),l){const t=document.createElement("label");t.setAttribute("for",this.id),t.innerText=l,this.element.appendChild(t)}this.searchbox=document.createElement("input"),this.searchbox.setAttribute("id",this.id),this.searchbox.setAttribute("type","text"),this.searchbox.setAttribute("placeholder","Query"),this.element.appendChild(this.searchbox),this.selection&&(this.searchbox.addEventListener("input",(()=>{this.publish(this.searchbox.value||null)})),s(this.selection)?(this.searchbox.addEventListener("pointerenter",(t=>{t.buttons||this.activate()})),this.searchbox.addEventListener("focus",(()=>this.activate()))):this.selection.addEventListener("value",(t=>{t!==this.searchbox.value&&(this.searchbox.value=t)})))}reset(){this.searchbox.value=""}clause(t){const{field:e,type:s}=this;return l(e,t,{source:this,method:s})}activate(){this.selection.activate(this.clause(""))}publish(t){const{selection:e}=this;s(e)?e.update(this.clause(t)):n(e)&&e.update(t)}query(t=[]){const{from:e,column:s}=this;return e?o.from(e).select({list:s}).distinct().where(t):null}queryResult(t){return this.data=t,this}update(){const t=document.createElement("datalist"),e=`${this.id}_list`;t.setAttribute("id",e);for(const e of this.data){const s=document.createElement("option");s.setAttribute("value",e.list),t.append(s)}return this.datalist&&this.datalist.remove(),this.element.appendChild(this.datalist=t),this.searchbox.setAttribute("list",e),this}}let E=0;const C=t=>p(A,t);class A extends e{constructor({element:t,filterBy:e,as:i,min:n,max:l,step:r,from:h,column:a,label:o=a,value:c=i?.value,select:u="point",field:d=a,width:m}={}){if(super(e),this.id="slider_"+ ++E,this.from=h,this.column=a||"value",this.selection=i,this.selectionType=u,this.field=d,this.min=n,this.max=l,this.step=r,this.element=t||document.createElement("div"),this.element.setAttribute("class","input"),Object.defineProperty(this.element,"value",{value:this}),o){const t=document.createElement("label");t.setAttribute("for",this.id),t.innerText=o,this.element.appendChild(t)}this.slider=document.createElement("input"),this.slider.setAttribute("id",this.id),this.slider.setAttribute("type","range"),null!=m&&(this.slider.style.width=+m+"px"),null!=n&&this.slider.setAttribute("min",`${n}`),null!=l&&this.slider.setAttribute("max",`${l}`),null!=r&&this.slider.setAttribute("step",`${r}`),this.element.appendChild(this.slider),this.curval=document.createElement("label"),this.curval.setAttribute("for",this.id),this.curval.setAttribute("class","value"),this.element.appendChild(this.curval),null!=c&&(this.slider.setAttribute("value",`${c}`),void 0===this.selection?.value&&this.publish(c)),this.curval.innerText=this.slider.value,this.slider.addEventListener("input",(()=>{const{value:t}=this.slider;this.curval.innerText=t,this.selection&&this.publish(+t)})),this.selection&&(s(this.selection)?(this.slider.addEventListener("pointerenter",(t=>{t.buttons||this.activate()})),this.slider.addEventListener("focus",(()=>this.activate()))):this.selection.addEventListener("value",(t=>{t!==+this.slider.value&&(this.slider.value=t,this.curval.innerText=t)})))}query(t=[]){const{from:e,column:s}=this;return!e||null!=this.min&&null!=this.max?null:o.select({min:c(s),max:u(s)}).from(e).where(t)}queryResult(t){const{min:e,max:s}=Array.from(t)[0];return null==this.min&&(this.min=e,this.slider.setAttribute("min",`${e}`)),null==this.max&&(this.max=s,this.slider.setAttribute("max",`${s}`)),null==this.step&&(this.step=(s-e)/500,this.slider.setAttribute("step",`${this.step}`)),this}clause(t){const{field:e,selectionType:s}=this;if("interval"===s){const s=[this.min??0,t];return r(e,s,{source:this,bin:"ceil",scale:{type:"identity",domain:s},pixelSize:this.step})}return i(e,t,{source:this})}activate(){this.selection.activate(this.clause(0))}publish(t){const{selection:e}=this;s(e)?e.update(this.clause(t)):n(this.selection)&&e.update(t)}}const w=$((t=>{const e=g(t);return t=>null==t?"":"number"==typeof t?e(t):t instanceof Date?L(t):`${t}`})),g=$((t=>e=>0===e?"0":e.toLocaleString(t)));function L(t){return m(t,"Invalid Date")}function $(t){let e,s=null;return(i="en")=>i===s?e:e=t(s=i)}w(),g();let T=-1;const _=t=>p(q,t);class q extends e{constructor({element:t,filterBy:e,from:s,columns:i=["*"],align:l={},format:r,width:h,maxWidth:a,height:o=500,rowBatch:c=100,as:u}={}){super(e),this.id="table-"+ ++T,this.from=s,this.columns=i,this.format=r,this.align=l,this.widths="object"==typeof h?h:{},n(s)&&s.addEventListener("value",(()=>this.initialize())),this.offset=0,this.limit=+c,this.pending=!1,this.selection=u,this.currentRow=-1,this.sortHeader=null,this.sortColumn=null,this.sortDesc=!1,this.element=t||document.createElement("div"),this.element.setAttribute("id",this.id),Object.defineProperty(this.element,"value",{value:this}),"number"==typeof h&&(this.element.style.width=`${h}px`),a&&(this.element.style.maxWidth=`${a}px`),this.element.style.maxHeight=`${o}px`,this.element.style.overflow="auto";let d=-1;this.element.addEventListener("scroll",(t=>{const{pending:e,loaded:s}=this,{scrollHeight:i,scrollTop:n,clientHeight:l}=t.target,r=n<d;d=n,r||e||s||i-n<2*l&&(this.pending=!0,this.requestData(this.offset+this.limit))})),this.tbl=document.createElement("table"),this.element.appendChild(this.tbl),this.head=document.createElement("thead"),this.tbl.appendChild(this.head),this.body=document.createElement("tbody"),this.tbl.appendChild(this.body),this.selection&&(this.body.addEventListener("pointerover",(t=>{const e=function(t){const e=t.parentElement;return Object.hasOwn(e,"__row__")?+e.__row__:-1}(t.target);e>-1&&e!==this.currentRow&&(this.currentRow=e,this.selection.update(this.clause([e])))})),this.body.addEventListener("pointerleave",(()=>{this.currentRow=-1,this.selection.update(this.clause())}))),this.style=document.createElement("style"),this.element.appendChild(this.style)}sourceTable(){return n(this.from)?this.from.value:this.from}clause(t=[]){const{data:e,limit:s,schema:i}=this,n=i.map((t=>t.column)),l=t.map((t=>{const{columns:i}=e[~~(t/s)];return n.map((e=>i[e][t%s]))}));return h(n,l,{source:this})}requestData(e=0){this.offset=e;const s=this.query(this.filterBy?.predicate(this));this.requestQuery(s),t().prefetch(s.clone().offset(e+this.limit))}fields(){const t=this.sourceTable();return this.columns.map((e=>({column:e,table:t})))}fieldInfo(t){this.schema=t;const e=this.head;e.innerHTML="";const s=document.createElement("tr");for(const{column:e}of t){const t=document.createElement("th");t.addEventListener("click",(t=>this.sort(t,e))),t.appendChild(document.createElement("span")),t.appendChild(document.createTextNode(e)),s.appendChild(t)}return e.appendChild(s),this.formats=function(t={},e,s){return e.map((({column:e,type:i})=>{if(e in t)return t[e];switch(i){case"number":return g(s);case"date":return L;default:return w(s)}}))}(this.format,t),this.style.innerText=function(t,e,s){const i=[];return e.forEach(((e,n)=>{const l=+s[n];if("left"!==e||l){const s="left"!==e?`text-align:${e};`:"",r=l?`width:${l}px;max-width:${l}px;`:"";i.push(`#${t} tr>:nth-child(${n+1}) {${s}${r}}`)}})),i.join(" ")}(this.id,function(t={},e){return e.map((({column:e,type:s})=>e in t?t[e]:"number"===s?"right":"left"))}(this.align,t),function(t={},e){return e.map((({column:e})=>t[e]))}(this.widths,t)),this}query(t=[]){const{limit:e,offset:s,schema:i,sortColumn:n,sortDesc:l}=this;return o.from(this.sourceTable()).select(i.map((t=>t.column))).where(t).orderby(n?l?d(n):n:[]).limit(e).offset(s)}queryResult(t){return this.pending||(this.loaded=!1,this.data=[],this.body.replaceChildren(),this.offset=0),this.data.push(a(t)),this}update(){const{body:t,formats:e,data:s,schema:i,limit:n}=this,l=i.length,r=s.length-1,h=n*r,{numRows:a,columns:o}=s[r],c=i.map((t=>o[t.column]));for(let s=0;s<a;++s){const i=document.createElement("tr");Object.assign(i,{__row__:h+s});for(let t=0;t<l;++t){const n=c[t][s],l=document.createElement("td");l.innerText=null==n?"":e[t](n),i.appendChild(l)}t.appendChild(i)}return a<n&&(this.loaded=!0),this.pending=!1,this}sort(t,e){e===this.sortColumn?this.sortDesc=!this.sortDesc:(this.sortColumn=e,this.sortDesc=!1);const s=t.currentTarget,i=this.sortHeader;i===s&&t.metaKey?(i.firstChild.textContent="",this.sortHeader=null,this.sortColumn=null):(i&&(i.firstChild.textContent=""),this.sortHeader=s,s.firstChild.textContent=this.sortDesc?"▾":"▴"),this.requestData()}}export{v as Menu,y as Search,A as Slider,q as Table,f as menu,x as search,C as slider,_ as table};export default null;
