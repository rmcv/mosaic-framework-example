/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.37.0.
 * Original file: /npm/@uwdata/mosaic-sql@0.12.2/src/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
const t="COLUMN_REF",n="COLUMN_PARAM",e="ORDER_BY",r="CAST",s="CASE",i="WHEN",u="UNARY",o="BINARY",c="BETWEEN",a="NOT_BETWEEN",f="LOGICAL_OPERATOR",l="IN",h="FUNCTION",p="AGGREGATE",d="WINDOW",g="WINDOW_DEF",_="WINDOW_FRAME",m="EXPRESSION",y="FRAGMENT",w="VERBATIM",x="PARAM",E="SELECT_CLAUSE",$="FROM_CLAUSE",S="WINDOW_CLAUSE",b="SELECT_QUERY",v="DESCRIBE_QUERY",A="SET_OPERATION";function N(t){return t instanceof T}class T{constructor(t){this.type=t}}class I extends T{}class L extends I{constructor(t){super("LITERAL"),this.value=t}toString(){return O(this.value)}}function O(t){switch(typeof t){case"number":return Number.isFinite(t)?`${t}`:"NULL";case"string":return`'${t.replace("'","''")}'`;case"boolean":return t?"TRUE":"FALSE";default:if(null==t)return"NULL";if(t instanceof Date){const n=+t;if(Number.isNaN(n))return"NULL";const e=t.getUTCFullYear(),r=t.getUTCMonth(),s=t.getUTCDate();return n===Date.UTC(e,r,s)?`DATE '${e}-${r+1}-${s}'`:`epoch_ms(${n})`}return t instanceof RegExp?`'${t.source}'`:`${t}`}}class R extends I{constructor(t){super(x),this.param=t}get value(){return this.param.value}toString(){return O(this.value)}}function q(t){return t.split(".")}function M(t){return`"${t}"`}function j(t){return t&&function(t){return'"'===t[0]&&'"'===t[t.length-1]}(t)?t.slice(1,-1):t}function F(t){return t instanceof C}class C extends I{constructor(t){super("TABLE_REF"),this.table=[t].flat()}get name(){return this.table[this.table.length-1]}toString(){return this.table.map((t=>M(t))).join(".")}}class D extends I{constructor(t,n=[]){super(h),this.name=t,this.args=n}toString(){const{name:t,args:n}=this;return`${t}(${n.join(", ")})`}}function U(t,...n){return new D(t,P(n).map(at))}function W(t,...n){return new dt(t,P(n).map(at))}function B(t,...n){return new V(new X(t,P(n).map(at)))}function k(t,n=at){return t.flat().filter((t=>null!=t)).map((t=>n(t)))}function P(t){const n=t.length;let e=n;for(;e>0&&void 0===t[e-1];--e);return e<n?t.slice(0,e):t}function G(t){return"string"==typeof t}function Y(t){return Array.isArray(t)}function H(t){return t&&"function"==typeof t.addEventListener&&!1!==t.dynamic&&"value"in t}class Q extends T{constructor(t,n){super(S),this.name=t,this.def=n}toString(){return`${M(this.name)} AS ${this.def}`}}class V extends I{constructor(t,n=new z){super(d),this.func=t,this.def=n}over(t){return new V(this.func,this.def.over(t))}partitionby(...t){return new V(this.func,this.def.partitionby(...t))}orderby(...t){return new V(this.func,this.def.orderby(...t))}rows(t){return new V(this.func,this.def.rows(t))}range(t){return new V(this.func,this.def.range(t))}toString(){return`${this.func} OVER ${this.def}`}}class X extends D{constructor(t,n){super(t,n)}}class z extends T{constructor(t,n,e,r){super(g),this.name=t,this.partition=n,this.order=e,this.frame=r}over(t){return K(this,{name:t})}partitionby(...t){return K(this,{partition:k(t)})}orderby(...t){return K(this,{order:k(t)})}rows(t){return K(this,{frame:new J(t)})}range(t){return K(this,{frame:new J(t,!0)})}toString(){const{name:t,partition:n,order:e,frame:r}=this,s=t&&M(t),i=[s,n?.length&&`PARTITION BY ${n.join(", ")}`,e?.length&&`ORDER BY ${e.join(", ")}`,r].filter((t=>t));return s&&i.length<2?s:`(${i.join(" ")})`}}class J extends T{constructor(t,n=!1,e=void 0){super(_),this.extent=H(t)?new R(t):t,this.range=n,this.exclude=e}toString(){const{range:t,exclude:n,extent:e}=this,r=t?"RANGE":"ROWS",[s,i]=N(e)?e.value:e;return`${r} BETWEEN ${Z(s,"PRECEDING")} AND ${Z(i,"FOLLOWING")}${n?` ${n}`:""}`}}function K(t,n){return new z(n.name??t.name,n.partition??t.partition,n.order??t.order,n.frame??t.frame)}function Z(t,n){return 0===t?"CURRENT ROW":Number.isFinite(t)?`${Math.abs(t)} ${n}`:`UNBOUNDED ${n}`}function tt(t){return t instanceof nt}class nt extends I{constructor(t,n){super(t),this.table=n}get column(){return null}toString(){const{column:t,table:n}=this,e=`${n??""}`;return(e?e+".":"")+("*"===t?"*":M(t))}}class et extends nt{constructor(n,e){super(t,e),this.name=n}get column(){return this.name}}function rt(t){return t instanceof st}class st extends nt{constructor(t,e){super(n,e),this.param=t}get column(){return`${this.param.value}`}}function it(t,n){const e=ht(n);return H(t)?new st(new R(t),e):new et(t,e)}class ut extends I{constructor(t){super(w),this.value=t}toString(){return this.value}}function ot(t){return new L(t)}function ct(...t){const n=k(t,String);return n?.length?new C(n):void 0}function at(t){return G(t)?function(t){const n=q(t);return it(n.pop(),ct(n))}(t):lt(t)}function ft(t){return G(t)?function(t){return new ut(t)}(t):lt(t)}function lt(t){return t instanceof I?t:H(t)?new R(t):ot(t)}function ht(t){return G(t)?ct(q(t)):Y(t)?ct(t):t}function pt(){return new z}class dt extends I{constructor(t,n,e,r){super(p),this.name=t,this.args=n,this.isDistinct=e,this.filter=r}distinct(t=!0){return new dt(this.name,this.args,t,this.filter)}where(t){return G(t)&&(t=ft(t)),new dt(this.name,this.args,this.isDistinct,t)}window(){return new V(this)}partitionby(...t){return this.window().partitionby(...t)}orderby(...t){return this.window().orderby(...t)}toString(){const{name:t,args:n,isDistinct:e,filter:r}=this;return`${t}(${e?"DISTINCT ":""}${n?.length?n.join(", "):"*"})${r?` FILTER (WHERE ${r})`:""}`}}class gt extends I{constructor(t,n,e){super(t),this.expr=n,this.extent=e}toSQL(t){const{extent:n,expr:e}=this;return n?`(${e} ${t} ${n[0]} AND ${n[1]})`:""}}class _t extends gt{constructor(t,n){super(c,t,n)}toString(){return super.toSQL("BETWEEN")}}class mt extends gt{constructor(t,n){super(a,t,n)}toString(){return super.toSQL("NOT BETWEEN")}}class yt extends I{constructor(t,n,e){super(o),this.op=t,this.left=n,this.right=e}toString(){return`(${this.left} ${this.op} ${this.right})`}}class wt extends I{constructor(t=void 0,n=[],e=void 0){super(s),this.expr=t,this._when=n,this._else=e}when(t,n){return new wt(this.expr,this._when.concat(new xt(at(t),at(n))),this._else)}else(t){return new wt(this.expr,this._when,at(t))}toString(){return"CASE "+(this.expr?`${this.expr} `:"")+this._when.join(" ")+(this._else?` ELSE ${this._else}`:"")+" END"}}class xt extends T{constructor(t,n){super(i),this.when=t,this.then=n}toString(){return`WHEN ${this.when} THEN ${this.then}`}}class Et extends I{constructor(t,n){super(r),this.expr=t,this.cast=n}toString(){return`(${this.expr})::${this.cast}`}}class $t extends I{constructor(t){super(y),this.spans=t}toString(){return this.spans.join("")}}class St extends T{constructor(t,n=!1,e=void 0,r=void 0){super("SAMPLE_CLAUSE"),this.size=t,this.perc=n,this.method=e,this.seed=r}toString(){const{size:t,perc:n,method:e,seed:r}=this;return`${t}${n?"%":" ROWS"}${e?` (${e}${null!=r?`, ${r}`:""})`:""}`}}class bt extends T{constructor(t,n){super(E),this.expr=t,this.alias=n}toString(){const{expr:t,alias:n}=this;return!n||function(t,n){return t instanceof nt&&null==t.table&&t.column===n}(t,n)?`${t}`:`${t} AS ${M(n)}`}}class vt extends T{constructor(t,n){super("WITH_CLAUSE"),this.name=t,this.query=n}toString(){return`"${this.name}" AS (${this.query})`}}function At(t){return t instanceof It}function Nt(t){return t instanceof Lt}function Tt(t){return t instanceof Ot}class It extends I{static select(...t){return(new Lt).select(...t)}static from(...t){return(new Lt).from(...t)}static with(...t){return(new Lt).with(...t)}static union(...t){return new Rt("UNION",t.flat())}static unionAll(...t){return new Rt("UNION ALL",t.flat())}static intersect(...t){return new Rt("INTERSECT",t.flat())}static except(...t){return new Rt("EXCEPT",t.flat())}static describe(t){return new Ot(t)}constructor(t){super(t),this._orderby=[],this._limit=void 0,this._offset=void 0,this.cteFor=null}get subqueries(){return[]}clone(){return this}orderby(...t){return this._orderby=this._orderby.concat(k(t)),this}limit(t){return this._limit=Number.isFinite(t)?t:void 0,this}offset(t){return this._offset=Number.isFinite(t)?t:void 0,this}}class Lt extends It{constructor(){super(b),this._with=[],this._select=[],this._from=[],this._where=[],this._sample=void 0,this._groupby=[],this._having=[],this._window=[],this._qualify=[]}get subqueries(){const t=this.cteFor||this,n=(t instanceof Lt?t._with:[]).reduce(((t,n)=>(t[n.name]=n.query,t)),{}),e=[];return this._from.forEach((({expr:t})=>{if(At(t))e.push(t);else if(F(t)){const r=n[t.name];r&&e.push(r)}})),e}clone(){return Object.assign(new Lt,this)}with(...t){const n=[],e=(t,e)=>{const r=e.clone();r.cteFor=this,n.push(new vt(t,r))};return t.flat().forEach((t=>{if(null!=t)for(const n in t)e(n,t[n])})),this._with=this._with.concat(n),this}select(...t){const n=[],e=(t,e)=>n.push(new bt(null==t?t:at(t),j(e)));t.flat().forEach((t=>{if(null!=t)if(G(t))e(t,t);else if(tt(t))e(t,t.column);else if(Y(t))e(t[1],t[0]);else for(const n in t)e(t[n],n)}));const r=new Set(n.map((t=>t.alias)));return this._select=this._select.filter((t=>!r.has(t.alias))).concat(n.filter((t=>t.expr))),this}setSelect(...t){return this._select=[],this.select(...t)}distinct(t=!0){return this._distinct=!!t,this}from(...t){const n=[],e=(t,e)=>n.push(new qt(ht(t),j(e)));return t.flat().forEach((t=>{if(null!=t)if(G(t))e(t,t);else if(F(t))e(t,t.name);else if(N(t))e(t);else if(Y(t))e(t[1],t[0]);else for(const n in t)e(t[n],n)})),this._from=this._from.concat(n),this}setFrom(...t){return this._from=[],this.from(...t)}sample(t,n,e){let r;if("number"==typeof t){const s=t>0&&t<1,i=s?100*t:Math.floor(t);r=new St(i,s,n,e)}else r=t;return this._sample=r,this}where(...t){return this._where=this._where.concat(k(t,ft)),this}setWhere(...t){return this._where=[],this.where(...t)}groupby(...t){return this._groupby=this._groupby.concat(k(t)),this}setGroupby(...t){return this._groupby=[],this.groupby(...t)}having(...t){return this._having=this._having.concat(k(t,ft)),this}window(...t){const n=[];return t.flat().forEach((t=>{if(null!=t)for(const e in t)n.push(new Q(j(e),t[e]))})),this._window=this._window.concat(n),this}qualify(...t){return this._qualify=this._qualify.concat(k(t,ft)),this}toString(){const{_with:t,_select:n,_distinct:e,_from:r,_sample:s,_where:i,_groupby:u,_having:o,_window:c,_qualify:a,_orderby:f,_limit:l,_offset:h}=this,p=[];if(t.length&&p.push(`WITH ${t.join(", ")}`),p.push(`SELECT${e?" DISTINCT":""} ${n.join(", ")}`),r.length&&p.push(`FROM ${r.join(", ")}`),i.length){const t=i.map(String).filter((t=>t)).join(" AND ");t&&p.push(`WHERE ${t}`)}if(s&&p.push(`USING SAMPLE ${s}`),u.length&&p.push(`GROUP BY ${u.join(", ")}`),o.length){const t=o.map(String).filter((t=>t)).join(" AND ");t&&p.push(`HAVING ${t}`)}if(c.length&&p.push(`WINDOW ${c.join(", ")}`),a.length){const t=a.map(String).filter((t=>t)).join(" AND ");t&&p.push(`QUALIFY ${t}`)}return f.length&&p.push(`ORDER BY ${f.join(", ")}`),Number.isFinite(l)&&p.push(`LIMIT ${l}`),Number.isFinite(h)&&p.push(`OFFSET ${h}`),p.join(" ")}}class Ot extends T{constructor(t){super(v),this.query=t}clone(){return new Ot(this.query.clone())}toString(){return`DESCRIBE ${this.query}`}}class Rt extends It{constructor(t,n){super(A),this.op=t,this.queries=n}get subqueries(){const{queries:t,cteFor:n}=this;return n&&t.forEach((t=>t.cteFor=n)),t}clone(){const{op:t,queries:n,...e}=this;return Object.assign(new Rt(t,n),e)}toString(){const{op:t,queries:n,_orderby:e,_limit:r,_offset:s}=this,i=[n.join(` ${t} `)];return e.length&&i.push(`ORDER BY ${e.join(", ")}`),Number.isFinite(r)&&i.push(`LIMIT ${r}`),Number.isFinite(s)&&i.push(`OFFSET ${s}`),i.join(" ")}}class qt extends T{constructor(t,n){super($),this.expr=t,this.alias=n}toString(){const{expr:t,alias:n}=this,e=At(t)?`(${t})`:`${t}`;return!n||F(t)&&t.table.join(".")===n?`${e}`:`${e} AS ${M(n)}`}}class Mt extends I{constructor(t,n){super("IN"),this.expr=t,this.values=n}toString(){return`(${this.expr} IN (${this.values.join(", ")}))`}}class jt extends I{constructor(t,n=1){super("INTERVAL"),this.name=t,this.steps=n}toString(){return`INTERVAL ${this.steps} ${this.name}`}}class Ft extends I{constructor(t,n){super(f),this.op=t,this.clauses=n}toString(){const t=this.clauses;return 0===t.length?"":1===t.length?`${t[0]}`:`(${t.join(` ${this.op} `)})`}}class Ct extends Ft{constructor(t){super("AND",t)}}class Dt extends Ft{constructor(t){super("OR",t)}}class Ut extends I{constructor(t,n,r){super(e),this.expr=t,this.desc=n,this.nullsFirst=r}toString(){const{expr:t,desc:n,nullsFirst:e}=this;return`${t}${n?" DESC":!1===n?" ASC":""}${e?" NULLS FIRST":!1===e?" NULLS LAST":""}`}}class Wt extends I{constructor(t,n,e){super(t),this.op=n,this.expr=e}}class Bt extends Wt{constructor(t,n){super(u,t,n)}toString(){return`(${this.op} ${this.expr})`}}class kt extends Wt{constructor(t,n){super("UNARY_POSTFIX",t,n)}toString(){return`(${this.expr} ${this.op})`}}function Pt(t,n){return W("arg_max",t,n)}function Gt(t,n){return W("arg_min",t,n)}function Yt(t){return W("array_agg",t)}function Ht(t){return W("avg",t)}function Qt(t,n){return W("corr",t,n)}function Vt(t){return W("count",t)}function Xt(t,n){return W("covar_samp",t,n)}function zt(t,n){return W("covar_pop",t,n)}function Jt(t){return W("entropy",t)}function Kt(t){return W("first",t)}function Zt(t){return W("kurtosis",t)}function tn(t){return W("mad",t)}function nn(t){return W("max",t)}function en(t){return W("median",t)}function rn(t){return W("min",t)}function sn(t){return W("mode",t)}function un(t){return W("last",t)}function on(t){return W("product",t)}function cn(t,n){return W("quantile",t,n)}function an(t,n){return W("regr_avgx",t,n)}function fn(t,n){return W("regr_avgy",t,n)}function ln(t,n){return W("regr_count",t,n)}function hn(t,n){return W("regr_intercept",t,n)}function pn(t,n){return W("regr_r2",t,n)}function dn(t,n){return W("regr_sxx",t,n)}function gn(t,n){return W("regr_sxy",t,n)}function _n(t,n){return W("regr_syy",t,n)}function mn(t,n){return W("regr_slope",t,n)}function yn(t){return W("skewness",t)}function wn(t){return W("stddev",t)}function xn(t){return W("stddev_pop",t)}function En(t){return W("string_agg",t)}function $n(t){return W("sum",t)}function Sn(t){return W("var_samp",t)}function bn(t){return W("var_pop",t)}function vn(t,n,e){return t?new wt(void 0,[new xt(at(t),at(n))],at(e)):new wt}function An(t,n){return new Et(at(t),n)}function Nn(t){return An(t,"INTEGER")}function Tn(t){return An(t,"FLOAT")}function In(t){return An(t,"DOUBLE")}function Ln(t,n){return new jt(t,n)}function On(t){return U("epoch_ms",t)}function Rn(t,n,e=1){return U("time_bucket",Ln(n,e),t)}function qn(t){return U("make_date",2012,U("month",t),1)}function Mn(t){const n=at(t);return U("make_date",2012,U("month",n),U("day",n))}function jn(t){return U("make_date",2012,1,U("day",t))}function Fn(t){return U("isnan",t)}function Cn(t){return U("isfinite",t)}function Dn(t){return U("isinf",t)}function Un(...t){return U("greatest",...t)}function Wn(...t){return U("least",...t)}function Bn(t){return U("exp",t)}function kn(t){return U("log",t)}function Pn(t){return U("ln",t)}function Gn(t){return U("sign",t)}function Yn(t){return U("abs",t)}function Hn(t){return U("sqrt",t)}function Qn(t){return U("ceil",t)}function Vn(t){return U("floor",t)}function Xn(t,n){return U("round",t,n)}function zn(t){return U("trunc",t)}function Jn(t,n){return new Bt(t,at(n))}function Kn(t,n){return new kt(t,at(n))}function Zn(t,n,e){return new yt(t,at(n),at(e))}function te(t,n,e=!1){return new(e?mt:_t)(at(t),n?.map(at))}function ne(...t){return new Ct(k(t))}function ee(...t){return new Dt(k(t))}function re(t){return Jn("NOT",t)}function se(t){return Kn("IS NULL",t)}function ie(t){return Kn("IS NOT NULL",t)}function ue(t){return Jn("~",t)}function oe(t,n){return Zn("&",t,n)}function ce(t,n){return Zn("|",t,n)}function ae(t,n){return Zn("<<",t,n)}function fe(t,n){return Zn(">>",t,n)}function le(t,n){return Zn("+",t,n)}function he(t,n){return Zn("-",t,n)}function pe(t,n){return Zn("*",t,n)}function de(t,n){return Zn("/",t,n)}function ge(t,n){return Zn("//",t,n)}function _e(t,n){return Zn("%",t,n)}function me(t,n){return Zn("**",t,n)}function ye(t,n){return Zn("=",t,n)}function we(t,n){return Zn("<>",t,n)}function xe(t,n){return Zn("<",t,n)}function Ee(t,n){return Zn(">",t,n)}function $e(t,n){return Zn("<=",t,n)}function Se(t,n){return Zn(">=",t,n)}function be(t,n){return Zn("IS DISTINCT FROM",t,n)}function ve(t,n){return Zn("IS NOT DISTINCT FROM",t,n)}function Ae(t,n){return te(t,n,!1)}function Ne(t,n){return te(t,n,!0)}function Te(t,n){return new Mt(at(t),n.map(at))}function Ie(t,n){return new Ut(at(t),!1,n)}function Le(t,n){return new Ut(at(t),!0,n)}function Oe(t){return U("st_asgeojson",t)}function Re(t){return U("st_x",t)}function qe(t){return U("st_y",t)}function Me(t){return U("st_centroid",t)}function je(t){return Re(Me(t))}function Fe(t){return qe(Me(t))}function Ce(t,...n){return new $t(function(t,n){const e=[t[0]],r=n.length;for(let s=0,i=0;s<r;){const r=n[s];N(r)?e[++i]=r:H(r)?e[++i]=new R(r):e[i]+=G(r)?r:ot(r);const u=t[++s];N(e[i])?e[++i]=u:e[i]+=u}return e.filter((t=>t)).map((t=>G(t)?new ut(t):t))}(t,n))}function De(t,n,...e){return U(t,n,...P(e).map(lt))}function Ue(t,n,e){return De("regexp_matches",t,n,e)}function We(t,n){return De("contains",t,n)}function Be(t,n){return De("starts_with",t,n)}function ke(t,n){return De("ends_with",t,n)}function Pe(t){return De("lower",t)}function Ge(t){return De("upper",t)}function Ye(t){return De("length",t)}function He(){return B("row_number")}function Qe(){return B("rank")}function Ve(){return B("dense_rank")}function Xe(){return B("percent_rank")}function ze(){return B("cume_dist")}function Je(t){return B("ntile",t)}function Ke(t,n,e){return B("lag",t,n,e)}function Ze(t,n,e){return B("lead",t,n,e)}function tr(t){return B("first_value",t)}function nr(t){return B("last_value",t)}function er(t,n){return B("nth_value",t,n)}const rr={[p]:["args","filter"],[c]:["expr","extent"],[o]:["left","right"],[s]:["expr","_when","_else"],[r]:["expr"],[n]:["param","table"],[t]:["table"],[v]:["query"],[m]:["node"],[y]:["spans"],[$]:["expr"],[h]:["args"],[l]:["expr","values"],[f]:["clauses"],[a]:["expr","extent"],[e]:["expr"],[x]:["value"],[E]:["expr"],[b]:["_with","_select","_from","_where","_sample","_groupby","_having","_window","_qualify","_orderby"],[A]:["subqueries","_orderby"],[u]:["expr"],[i]:["when","then"],[d]:["func","def"],[S]:["def"],[g]:["partition","order","frame"],[_]:["extent"]};function sr(t,n){if(n.has(t))return n.get(t);if(N(t)){const e=rr[t.type],r=e?.length??0;for(let s=0;s<r;++s){const r=e[s],i=t[r];if(Array.isArray(i)){const t=i.length;for(let e=0;e<t;++e)i[e]=sr(i[e],n)}else i&&(t[r]=sr(i,n))}}return t}function ir(t,n){if(!N(t))return;const e=n(t);if(e)return e;const r=rr[t.type],s=r?.length??0;for(let i=0;i<s;++i){const s=t[r[i]];if(Array.isArray(s)){const t=s.length;for(let r=0;r<t;++r)if(s[r]&&+ir(s[r],n)<0)return e}else if(s&&+ir(s,n)<0)return-1}}const ur=new RegExp(`^(${["any_value","approx_count_distinct","approx_quantile","arbitrary","arg_max","arg_max_null","arg_min","arg_min_null","array_agg","avg","bit_and","bit_or","bit_xor","bitstring_agg","bool_and","bool_or","corr","count","covar_pop","covar_samp","entropy","favg","first","fsum","geomean","kurtosis_pop","kurtosis","last","mad","max","max_by","median","min","min_by","mode","product","quantile","quantile_cont","quantile_disc","regr_avgx","regr_avgy","regr_count","regr_intercept","regr_r2","regr_sxx","regr_sxy","regr_syy","regr_slope","reservoir_quantile","skewness","stddev","stddev_pop","stddev_samp","string_agg","sum","variance","var_pop","var_samp"].join("|")})$`),or=/(\\'|\\"|"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|\w+\()/g;function cr(t){let n=0;return ir(t,(t=>{switch(t.type){case d:return-1;case p:return n|=1,-1;case y:case w:{let e=`${t}`.toLowerCase();const r=e.indexOf("(select ");return r>=0&&(e=e.slice(0,r)),e.includes(") over ")?-1:function(t){return t.split(or).some((t=>t.endsWith("(")&&ur.test(t.slice(0,-1))))}(e)?(n|=2,-1):1}}})),n}function ar(t){const n=new Set;return ir(t,(t=>{t.type===p&&n.add(t)})),Array.from(n)}function fr(e){const r={};return ir(e,(e=>{e.type!==t&&e.type!==n||(r[e]=e)})),Object.values(r)}function lr(t){const n=new Set;return ir(t,(t=>{t.type===x&&n.add(t.param)})),Array.from(n)}function hr(t,n,{replace:e=!1,temp:r=!1,view:s=!1}={}){return"CREATE"+(e?" OR REPLACE ":" ")+(r?"TEMP ":"")+(s?"VIEW":"TABLE")+(e?" ":" IF NOT EXISTS ")+t+" AS "+n}function pr(t,{strict:n=!1}={}){return"CREATE SCHEMA "+(n?"":"IF NOT EXISTS ")+t}function dr(t){return`INSTALL ${t}; LOAD ${t}`}function gr(t,n,e,r={},s={}){const{select:i=["*"],where:u,view:o,temp:c,replace:a,...f}=r,l=function(t){return Object.entries(t).map((([t,n])=>`${t}=${Er(n)}`)).join(", ")}({...s,...f}),h=`${t}('${e}'${l?", "+l:""})`,p=u?` WHERE ${u}`:"";return hr(n,`SELECT ${i.join(", ")} FROM ${h}${p}`,{view:o,temp:c,replace:a})}function _r(t,n,e){return gr("read_csv",t,n,e,{auto_detect:!0,sample_size:-1})}function mr(t,n,e){return gr("read_json",t,n,e,{auto_detect:!0,format:"auto"})}function yr(t,n,e){return gr("read_parquet",t,n,e)}function wr(t,n,e={}){const{options:r,...s}=e;if(r){const t=Array.isArray(r)?r.join(", "):"string"==typeof r?r:Object.entries(r).map((([t,n])=>`${t}=${n}`)).join(", ");Object.assign(s,{open_options:t.toUpperCase()})}return gr("st_read",t,n,s)}function xr(t,n,e={}){const{select:r=["*"],...s}=e,i=function(t,{columns:n=Object.keys(t?.[0]||{})}={}){let e=[];if(Array.isArray(n)?(e=n,n=e.reduce(((t,n)=>(t[n]=n,t)),{})):n&&(e=Object.keys(n)),!e.length)throw new Error("Can not create table from empty column set.");const r=[];for(const s of t){const t=e.map((t=>`${lt(s[t])} AS "${n[t]}"`));r.push(`(SELECT ${t.join(", ")})`)}return r.join(" UNION ALL ")}(n);return hr(t,1===r.length&&"*"===r[0]?i:`SELECT ${r} FROM ${i}`,s)}function Er(t){switch(typeof t){case"boolean":return String(t);case"string":return`'${t}'`;case"undefined":case"object":return null==t?"NULL":Array.isArray(t)?"["+t.map((t=>Er(t))).join(", ")+"]":"{"+Object.entries(t).map((([t,n])=>`'${t}': ${Er(n)}`)).join(", ")+"}";default:return t}}function $r(t,n,e,r,s){const i=s?he(e,In(t)):he(In(t),n),u=e===n?0:r/(e-n);return u?pe(i,In(u)):i}function Sr(t,n,e,r,s,i){return t.select({index:le(Nn(Vn(n)),pe(Nn(Vn(e)),s)),...r}).groupby("index",i)}function br(t,n,e=void 0,r=[]){const s=e?t=>pe(t,e):t=>t,i=Vn(n),u=le(i,1);return It.from(It.unionAll(t.clone().select({i:Nn(i),w:s(he(u,n))}),t.clone().select({i:Nn(u),w:s(he(n,i))}))).select({index:"i",density:$n("w")},r).groupby("index",r).having(we("density",0))}function vr(t){return t}function Ar(t,n,e,r,s,i=[]){const u=r?t=>pe(t,r):vr,o=(r,s)=>t.clone().select({xp:n,yp:e,i:r,w:s}),c=(t,n)=>le(t,pe(n,s)),a=Nn(Vn(n)),f=Nn(Vn(e)),l=le(a,1),h=le(f,1),p=he(n,a),d=he(l,n),g=he(e,f),_=he(h,e);return It.from(It.unionAll(o(c(a,f),u(pe(d,_))),o(c(a,h),u(pe(d,g))),o(c(l,f),u(pe(p,_))),o(c(l,h),u(pe(p,g))))).select({index:"i",density:$n("w")},i).groupby("index",i).having(we("density",0))}function Nr(t,n,e,r,s,i,u=[],o=!0){t.select({x:Nn(Vn(n)),y:Nn(Vn(e))});const c=u.concat(r),a=It.from(t).select(c,{x0:"x",y0:"y",dx:he(Ze("x").over("sw"),"x"),dy:he(Ze("y").over("sw"),"y")}).window({sw:pt().partitionby(c).orderby(Ie("x"))}).qualify([ee(xe("x0",s),xe(le("x0","dx"),s)),ee(xe("y0",i),xe(le("y0","dy"),i)),ee(Ee("x0",0),Ee(le("x0","dx"),0)),ee(Ee("y0",0),Ee(le("y0","dy"),0))]),f=It.select({x:Un(nn(Yn("dx")),nn(Yn("dy")))}).from("pairs"),l=It.select({i:Nn(Ce`UNNEST(range((${f})))`)}),h=It.unionAll(It.select(c,{x:le("x0","i"),y:le("y0",Nn(Xn(de(pe("i","dy"),"dx"))))}).from("pairs","indices").where([$e(Yn("dy"),Yn("dx")),xe("i",Yn("dx"))]),It.select(c,{x:le("x0",Nn(Xn(de(pe(pe(Gn("dy"),"i"),"dx"),"dy")))),y:le("y0",pe(Gn("dy"),"i"))}).from("pairs","indices").where([Ee(Yn("dy"),Yn("dx")),xe("i",Yn("dy"))]),It.select(c,{x:"x0",y:"y0"}).from("pairs").where(se("dx"))),p=It.from("raster").select(c,"x","y",o?{w:de(1,Vt().partitionby(["x"].concat(c)))}:null).where([$e(0,"x"),xe("x",s),$e(0,"y"),xe("y",i)]);return It.with({pairs:a,indices:l,raster:h,points:p}).from("points").select(u,{index:le("x",pe("y",Nn(s))),density:o?$n("w"):Vt()}).groupby("index",u)}function Tr(t,n,e,r,s=[]){const i=Nn(Vn(n)),u=n=>It.from(t).select(n).groupby(i,s);return It.union(u([{[e]:rn(e),[r]:Gt(r,e)},...s]),u([{[e]:nn(e),[r]:Pt(r,e)},...s]),u([{[e]:Gt(e,r),[r]:rn(r)},...s]),u([{[e]:Pt(e,r),[r]:nn(r)},...s])).orderby(s,e)}const Ir=t=>t;function Lr(){return{apply:Ir,invert:Ir,sqlApply:at,sqlInvert:Ir}}function Or(){return{apply:t=>+t,invert:t=>new Date(t),sqlApply:t=>t instanceof Date?ot(+t):function(t){return t instanceof L&&t.value instanceof Date}(t)?ot(+t.value):On(t),sqlInvert:Ir}}const Rr={identity:Lr,linear:Lr,log:function({base:t=null}={}){if(null==t||t===Math.E)return{apply:Math.log,invert:Math.exp,sqlApply:t=>Pn(t),sqlInvert:t=>Bn(t)};if(10===t)return{apply:Math.log10,invert:t=>Math.pow(10,t),sqlApply:t=>kn(t),sqlInvert:t=>me(10,t)};{const n=+t;return{apply:t=>Math.log(t)/Math.log(n),invert:t=>Math.pow(n,t),sqlApply:t=>de(Pn(t),Pn(n)),sqlInvert:t=>me(n,t)}}},symlog:function({constant:t=1}={}){const n=+t;return{apply:t=>Math.sign(t)*Math.log1p(Math.abs(t)),invert:t=>Math.sign(t)*Math.exp(Math.abs(t)-n),sqlApply:t=>pe(Gn(t=at(t)),Pn(le(n,Yn(t)))),sqlInvert:t=>pe(Gn(t),he(Bn(Yn(t)),n))}},sqrt:function(){return{apply:t=>Math.sign(t)*Math.sqrt(Math.abs(t)),invert:t=>Math.sign(t)*t*t,sqlApply:t=>pe(Gn(t=at(t)),Hn(Yn(t))),sqlInvert:t=>pe(Gn(t),me(t,2))}},pow:function({exponent:t=1}={}){const n=+t;return{apply:t=>Math.sign(t)*Math.pow(Math.abs(t),n),invert:t=>Math.sign(t)*Math.pow(Math.abs(t),1/n),sqlApply:t=>pe(Gn(t=at(t)),me(Yn(t),n)),sqlInvert:t=>pe(Gn(t),me(Yn(t),de(1,n)))}},time:Or,utc:Or};function qr(t){const n=Rr[t.type];return n?{...t,...n(t)}:null}export{dt as AggregateNode,Ct as AndNode,_t as BetweenOpNode,yt as BinaryOpNode,wt as CaseNode,Et as CastNode,et as ColumnNameRefNode,st as ColumnParamNode,nt as ColumnRefNode,Ot as DescribeQuery,I as ExprNode,$t as FragmentNode,qt as FromClauseNode,D as FunctionNode,Mt as InOpNode,jt as IntervalNode,L as LiteralNode,mt as NotBetweenOpNode,Dt as OrNode,Ut as OrderByNode,R as ParamNode,It as Query,T as SQLNode,St as SampleClauseNode,bt as SelectClauseNode,Lt as SelectQuery,Rt as SetOperation,C as TableRefNode,Bt as UnaryOpNode,kt as UnaryPosftixOpNode,ut as VerbatimNode,xt as WhenNode,Q as WindowClauseNode,z as WindowDefNode,J as WindowFrameNode,X as WindowFunctionNode,V as WindowNode,vt as WithClauseNode,Yn as abs,le as add,ne as and,Pt as argmax,Gt as argmin,Yt as arrayAgg,lt as asLiteral,at as asNode,ht as asTableRef,ft as asVerbatim,Ie as asc,Ht as avg,$r as bin1d,Sr as bin2d,br as binLinear1d,Ar as binLinear2d,oe as bitAnd,ae as bitLeft,ue as bitNot,ce as bitOr,fe as bitRight,An as cast,Qn as ceil,Me as centroid,je as centroidX,Fe as centroidY,ar as collectAggregates,fr as collectColumns,lr as collectParams,it as column,vn as cond,We as contains,Qt as corr,Vt as count,zt as covarPop,Xt as covariance,pr as createSchema,hr as createTable,ze as cume_dist,Rn as dateBin,jn as dateDay,qn as dateMonth,Mn as dateMonthDay,Ve as dense_rank,Le as desc,de as div,Jt as entropy,On as epoch_ms,ye as eq,Bn as exp,Kt as first,tr as first_value,Tn as float32,In as float64,Vn as floor,Oe as geojson,Un as greatest,Ee as gt,Se as gte,ge as idiv,Nn as int32,Ln as interval,cr as isAggregateExpression,Ae as isBetween,rt as isColumnParam,tt as isColumnRef,Tt as isDescribeQuery,be as isDistinct,Cn as isFinite,Te as isIn,Dn as isInfinite,Fn as isNaN,N as isNode,Ne as isNotBetween,ve as isNotDistinct,ie as isNotNull,se as isNull,H as isParamLike,At as isQuery,Nt as isSelectQuery,F as isTableRef,Zt as kurtosis,Ke as lag,un as last,nr as last_value,Ze as lead,Wn as least,Ye as length,Nr as lineDensity,ot as literal,Pn as ln,_r as loadCSV,dr as loadExtension,mr as loadJSON,xr as loadObjects,yr as loadParquet,wr as loadSpatial,kn as log,Pe as lower,xe as lt,$e as lte,Tr as m4,tn as mad,nn as max,en as median,rn as min,_e as mod,sn as mode,pe as mul,we as neq,re as not,er as nth_value,Je as ntile,ee as or,pt as over,Xe as percent_rank,me as pow,Be as prefix,on as product,cn as quantile,Qe as rank,Ue as regexp_matches,an as regrAvgX,fn as regrAvgY,ln as regrCount,hn as regrIntercept,pn as regrR2,dn as regrSXX,gn as regrSXY,_n as regrSYY,mn as regrSlope,sr as rewrite,Xn as round,He as row_number,qr as scaleTransform,Gn as sign,yn as skewness,Ce as sql,Hn as sqrt,wn as stddev,xn as stddevPop,En as stringAgg,he as sub,ke as suffix,$n as sum,zn as trunc,Ge as upper,bn as varPop,Sn as variance,ir as walk,Re as x,qe as y};export default null;
